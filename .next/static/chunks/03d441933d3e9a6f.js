(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,95187,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={callServer:function(){return l.callServer},createServerReference:function(){return n.createServerReference},findSourceMapURL:function(){return s.findSourceMapURL}};for(var i in a)Object.defineProperty(r,i,{enumerable:!0,get:a[i]});let l=e.r(32120),s=e.r(92245),n=e.r(35326)},70221,e=>{"use strict";var t=e.i(43476),r=e.i(71645);let a=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,r.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:l=2,absoluteStrokeWidth:s,className:n="",children:c,iconNode:d,...o},u)=>(0,r.createElement)("svg",{ref:u,...i,width:t,height:t,stroke:e,strokeWidth:s?24*Number(l)/Number(t):l,className:a("lucide",n),...o},[...d.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(c)?c:[c]])),s=(e,t)=>{let i=(0,r.forwardRef)(({className:i,...s},n)=>(0,r.createElement)(l,{ref:n,iconNode:t,className:a(`lucide-${e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,i),...s}));return i.displayName=`${e}`,i},n=s("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]),c=s("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),d=s("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var o=e.i(11795);async function u(e){let t=(0,o.createClient)(),{data:r,error:a}=await t.from("customers").select("id,full_name,email,loyalty_points").eq("id",e).single();return a?(console.error("Error obteniendo cliente:",a),null):r??null}var m=e.i(95187);let h=(0,m.createServerReference)("408093cec055993d27ccf31b16553a83b925d68f64",m.callServer,void 0,m.findSourceMapURL,"validateRedemption");async function p(e){try{let t;if(e.startsWith("VENTO-")){let t=await h(e);if(t.success&&t.redemption)return{type:"redemption",redemption:{id:t.redemption.id,reward_name:t.redemption.reward_name,points_spent:t.redemption.points_spent,status:t.redemption.status}}}try{let r=JSON.parse(e);t=r.user_id||r.id||e}catch{t=e}if(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t)){let e=await u(t);if(e)return{type:"client",client:{user_id:e.id,full_name:e.full_name??"",email:e.email,loyalty_points:e.loyalty_points||0}}}return{type:"unknown"}}catch(e){return console.error("Error al decodificar QR:",e),{type:"unknown"}}}let f=(0,m.createServerReference)("606344c6f1116c1de062d21a4b4bdf4d2412f5c316",m.callServer,void 0,m.findSourceMapURL,"processRedemptionAction");function v({onScan:e,selectedClient:a,onClear:i}){let[l,s]=(0,r.useState)(!1),[o,u]=(0,r.useState)(""),[m,h]=(0,r.useState)(null),[v,x]=(0,r.useState)(null),y=async()=>{if(x(null),h(null),!o.trim())return void x("Ingresa un codigo QR valido");s(!0);try{let t=await p(o.trim());if(!t)return void x("No se pudo identificar el codigo QR");if("redemption"===t.type){let e=await f(o.trim());e.success?(h(`Canje validado: ${e.redemption?.reward_name}`),u("")):x(e.error||"Error al validar el canje");return}if("client"===t.type&&t.client){e(t.client),u("");return}x("Codigo QR no reconocido")}catch(e){console.error("Error al decodificar el QR:",e),x("Error al decodificar el QR")}finally{s(!1)}};return(0,t.jsxs)("div",{className:"ui-panel",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(n,{className:"h-5 w-5 text-[var(--ui-brand)]"}),(0,t.jsx)("h3",{className:"ui-h3",children:"Cliente"})]}),a?(0,t.jsx)("div",{className:"mt-4 space-y-2",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 rounded-xl border border-[var(--ui-border)] bg-[var(--ui-surface-2)] px-3 py-2",children:[(0,t.jsx)(d,{className:"h-4 w-4 text-[var(--ui-brand)]"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-[var(--ui-text)] truncate",children:a.full_name}),void 0!==a.loyalty_points&&(0,t.jsxs)("p",{className:"text-xs text-[var(--ui-muted)]",children:[a.loyalty_points," puntos"]})]}),(0,t.jsx)("button",{type:"button",className:"ui-btn ui-btn--ghost",onClick:i,children:(0,t.jsx)(c,{className:"h-4 w-4"})})]})}):(0,t.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[(0,t.jsx)("input",{placeholder:"Pegar codigo QR o UUID",value:o,onChange:e=>u(e.target.value),onKeyDown:e=>{"Enter"===e.key&&y()},className:"ui-input flex-1"}),(0,t.jsx)("button",{type:"button",onClick:y,disabled:l,className:"ui-btn ui-btn--brand",children:l?"Escaneando...":"Buscar"})]}),(0,t.jsxs)("button",{type:"button",onClick:()=>{h("Escaner de camara proximamente")},className:"ui-btn ui-btn--ghost w-full",children:[(0,t.jsx)(n,{className:"h-4 w-4"}),"Escanear con camara"]})]}),m?(0,t.jsx)("div",{className:"mt-3 ui-alert ui-alert--success",children:m}):null,v?(0,t.jsx)("div",{className:"mt-3 ui-alert ui-alert--error",children:v}):null]})}function x(){let[e,a]=(0,r.useState)(null);return(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsxs)("div",{className:"ui-panel",children:[(0,t.jsx)("h1",{className:"ui-h1",children:"Pulso"}),(0,t.jsx)("p",{className:"mt-2 ui-body-muted",children:"Escanea clientes o canjes para puntos."})]}),(0,t.jsxs)("div",{className:"mt-6 grid gap-6 lg:grid-cols-[1.2fr_1fr]",children:[(0,t.jsx)(v,{selectedClient:e,onScan:e=>a(e),onClear:()=>a(null)}),(0,t.jsxs)("div",{className:"ui-panel",children:[(0,t.jsx)("div",{className:"ui-h3",children:"Estado"}),e?(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,t.jsx)("div",{className:"text-lg font-semibold",children:e.full_name}),(0,t.jsx)("div",{className:"ui-body-muted",children:e.email??"Sin email"}),(0,t.jsxs)("div",{className:"text-sm text-[var(--ui-brand)]",children:["Puntos: ",e.loyalty_points??0]})]}):(0,t.jsx)("div",{className:"mt-3 ui-body-muted",children:"Esperando escaneo. Pega el QR o usa la camara."})]})]})]})}e.s(["ScannerPage",()=>x],70221)}]);