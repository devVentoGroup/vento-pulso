module.exports=[5050,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={callServer:function(){return f.callServer},createServerReference:function(){return h.createServerReference},findSourceMapURL:function(){return g.findSourceMapURL}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(20611),g=a.r(1722),h=a.r(38783)},40777,a=>{"use strict";var b=a.i(87924),c=a.i(72131);let d=(...a)=>a.filter((a,b,c)=>!!a&&""!==a.trim()&&c.indexOf(a)===b).join(" ").trim();var e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let f=(0,c.forwardRef)(({color:a="currentColor",size:b=24,strokeWidth:f=2,absoluteStrokeWidth:g,className:h="",children:i,iconNode:j,...k},l)=>(0,c.createElement)("svg",{ref:l,...e,width:b,height:b,stroke:a,strokeWidth:g?24*Number(f)/Number(b):f,className:d("lucide",h),...k},[...j.map(([a,b])=>(0,c.createElement)(a,b)),...Array.isArray(i)?i:[i]])),g=(a,b)=>{let e=(0,c.forwardRef)(({className:e,...g},h)=>(0,c.createElement)(f,{ref:h,iconNode:b,className:d(`lucide-${a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,e),...g}));return e.displayName=`${a}`,e},h=g("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]),i=g("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),j=g("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var k=a.i(95445);async function l(a){let b=(0,k.createClient)(),{data:c,error:d}=await b.from("customers").select("id,full_name,email,loyalty_points").eq("id",a).single();return d?(console.error("Error obteniendo cliente:",d),null):c??null}var m=a.i(5050);let n=(0,m.createServerReference)("408093cec055993d27ccf31b16553a83b925d68f64",m.callServer,void 0,m.findSourceMapURL,"validateRedemption");async function o(a){try{let b;if(a.startsWith("VENTO-")){let b=await n(a);if(b.success&&b.redemption)return{type:"redemption",redemption:{id:b.redemption.id,reward_name:b.redemption.reward_name,points_spent:b.redemption.points_spent,status:b.redemption.status}}}try{let c=JSON.parse(a);b=c.user_id||c.id||a}catch{b=a}if(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(b)){let a=await l(b);if(a)return{type:"client",client:{user_id:a.id,full_name:a.full_name??"",email:a.email,loyalty_points:a.loyalty_points||0}}}return{type:"unknown"}}catch(a){return console.error("Error al decodificar QR:",a),{type:"unknown"}}}let p=(0,m.createServerReference)("606344c6f1116c1de062d21a4b4bdf4d2412f5c316",m.callServer,void 0,m.findSourceMapURL,"processRedemptionAction");function q({onScan:a,selectedClient:d,onClear:e}){let[f,g]=(0,c.useState)(!1),[k,l]=(0,c.useState)(""),[m,n]=(0,c.useState)(null),[q,r]=(0,c.useState)(null),s=async()=>{if(r(null),n(null),!k.trim())return void r("Ingresa un codigo QR valido");g(!0);try{let b=await o(k.trim());if(!b)return void r("No se pudo identificar el codigo QR");if("redemption"===b.type){let a=await p(k.trim());a.success?(n(`Canje validado: ${a.redemption?.reward_name}`),l("")):r(a.error||"Error al validar el canje");return}if("client"===b.type&&b.client){a(b.client),l("");return}r("Codigo QR no reconocido")}catch(a){console.error("Error al decodificar el QR:",a),r("Error al decodificar el QR")}finally{g(!1)}};return(0,b.jsxs)("div",{className:"ui-panel",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(h,{className:"h-5 w-5 text-[var(--ui-brand)]"}),(0,b.jsx)("h3",{className:"ui-h3",children:"Cliente"})]}),d?(0,b.jsx)("div",{className:"mt-4 space-y-2",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-xl border border-[var(--ui-border)] bg-[var(--ui-surface-2)] px-3 py-2",children:[(0,b.jsx)(j,{className:"h-4 w-4 text-[var(--ui-brand)]"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-[var(--ui-text)] truncate",children:d.full_name}),void 0!==d.loyalty_points&&(0,b.jsxs)("p",{className:"text-xs text-[var(--ui-muted)]",children:[d.loyalty_points," puntos"]})]}),(0,b.jsx)("button",{type:"button",className:"ui-btn ui-btn--ghost",onClick:e,children:(0,b.jsx)(i,{className:"h-4 w-4"})})]})}):(0,b.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[(0,b.jsx)("input",{placeholder:"Pegar codigo QR o UUID",value:k,onChange:a=>l(a.target.value),onKeyDown:a=>{"Enter"===a.key&&s()},className:"ui-input flex-1"}),(0,b.jsx)("button",{type:"button",onClick:s,disabled:f,className:"ui-btn ui-btn--brand",children:f?"Escaneando...":"Buscar"})]}),(0,b.jsxs)("button",{type:"button",onClick:()=>{n("Escaner de camara proximamente")},className:"ui-btn ui-btn--ghost w-full",children:[(0,b.jsx)(h,{className:"h-4 w-4"}),"Escanear con camara"]})]}),m?(0,b.jsx)("div",{className:"mt-3 ui-alert ui-alert--success",children:m}):null,q?(0,b.jsx)("div",{className:"mt-3 ui-alert ui-alert--error",children:q}):null]})}function r(){let[a,d]=(0,c.useState)(null);return(0,b.jsxs)("div",{className:"w-full",children:[(0,b.jsxs)("div",{className:"ui-panel",children:[(0,b.jsx)("h1",{className:"ui-h1",children:"Pulso"}),(0,b.jsx)("p",{className:"mt-2 ui-body-muted",children:"Escanea clientes o canjes para puntos."})]}),(0,b.jsxs)("div",{className:"mt-6 grid gap-6 lg:grid-cols-[1.2fr_1fr]",children:[(0,b.jsx)(q,{selectedClient:a,onScan:a=>d(a),onClear:()=>d(null)}),(0,b.jsxs)("div",{className:"ui-panel",children:[(0,b.jsx)("div",{className:"ui-h3",children:"Estado"}),a?(0,b.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,b.jsx)("div",{className:"text-lg font-semibold",children:a.full_name}),(0,b.jsx)("div",{className:"ui-body-muted",children:a.email??"Sin email"}),(0,b.jsxs)("div",{className:"text-sm text-[var(--ui-brand)]",children:["Puntos: ",a.loyalty_points??0]})]}):(0,b.jsx)("div",{className:"mt-3 ui-body-muted",children:"Esperando escaneo. Pega el QR o usa la camara."})]})]})]})}a.s(["default",()=>r],40777)}];

//# sourceMappingURL=_bcf04a17._.js.map